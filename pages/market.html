<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>IRAN NFT – Solana Market</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="../assets/css/market.css" />
  <link rel="icon" type="image/x-icon" href="../images/PC22.ico" />

  <!-- iOS / iPadOS Home Screen -->
  <link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon-180.png" />

  <!-- Android / Chrome PWA -->
  <link rel="manifest" href="/site.webmanifest" />
  <meta name="theme-color" content="#0b0e11" />

  <!-- Safari pinned tab (macOS) - تک‌رنگ -->
  <link rel="mask-icon" href="../images/safari-pinned-tab.svg" color="#c5a15b" />

  <!-- Windows tiles (اختیاری) -->
  <meta name="msapplication-TileColor" content="#0b0e11" />
  <meta name="msapplication-square150x150logo" content="../images/mstile-150.png" />
</head>

<body class="theme-dark">
  <!-- Header -->
  <header class="market-header">
    <div class="brand">
      <img src="../images/pc2.png" alt="IRAN NFT Logo" class="brand-logo">
      <div class="brand-text">
        <h1>IRAN NFT Market</h1>
        <p>Solana-based cultural NFT marketplace</p>
      </div>
    </div>

    <nav class="market-nav">
      <a href="index.html" class="nav-link">Home</a>
      <button id="exploreTabBtn" class="nav-link nav-link--tab active">Explore</button>
      <button id="myPanelTabBtn" class="nav-link nav-link--tab">My Panel</button>
    </nav>

    <div class="wallet-area">
      <span id="networkBadge" class="badge badge-sol">Solana</span>
      <button id="connectWalletBtn" class="btn btn-primary">Connect Wallet</button>
      <div id="walletInfo" class="wallet-info hidden">
        <span id="walletAddressShort"></span>
        <button id="disconnectBtn" class="btn btn-ghost">Disconnect</button>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="market-main">
    <!-- EXPLORE -->
    <section id="exploreSection" class="section active">
      <div class="section-header">
        <h2>Explore Collections</h2>
        <p>Unique cultural NFTs from the heart of Iran, minted on Solana.</p>
      </div>

      <div class="filters">
        <select id="categoryFilter" class="filter-select">
          <option value="all">All Categories</option>
          <option value="Architecture">Architecture</option>
          <option value="Art">Art</option>
          <option value="History">History</option>
          <option value="Culture">Culture</option>
        </select>

        <select id="sortFilter" class="filter-select">
          <option value="latest">Latest</option>
          <option value="priceLowHigh">Price: Low → High</option>
          <option value="priceHighLow">Price: High → Low</option>
        </select>
      </div>

      <div id="nftGrid" class="nft-grid">
        <!-- Cards injected by JS -->
      </div>

      <div id="emptyStateExplore" class="empty-state hidden">
        <h3>No NFTs found</h3>
        <p>Try changing filters or check back soon for new drops.</p>
      </div>
    </section>

    <!-- MY PANEL -->
    <section id="myPanelSection" class="section">
      <div class="section-header">
        <h2>My Panel</h2>
        <p>See your IRAN NFT holdings, listings and future tools.</p>
      </div>

      <!-- Not connected -->
      <div id="panelNotConnected" class="panel-card">
        <h3>Connect your wallet</h3>
        <p>
          To see your IRAN NFT holdings on Solana and manage listings, please connect your Phantom wallet.
        </p>
        <button class="btn btn-primary" id="panelConnectBtn">Connect Wallet</button>
      </div>

      <!-- Connected -->
      <div id="panelConnected" class="panel-card hidden">
        <div class="panel-header-row">
          <div>
            <h3>Wallet dashboard</h3>
            <p class="muted">
              Solana address:
              <span id="panelWalletFull" class="mono"></span>
            </p>
          </div>
          <span class="badge badge-sol">Solana</span>
        </div>

        <!-- Panel inner tabs -->
        <div class="panel-tabs">
          <button class="panel-tab-btn active" data-panel-tab="overview">Overview</button>
          <button class="panel-tab-btn" data-panel-tab="collection">My Collection</button>
          <button class="panel-tab-btn" data-panel-tab="listings">My Listings</button>
        </div>

        <!-- OVERVIEW TAB -->
        <div id="panelOverview" class="panel-tab active">
          <div class="panel-overview-grid">
            <div class="stat-card">
              <span class="stat-label">Owned in IRAN NFT collections (demo)</span>
              <div class="stat-value"><span id="statOwnedCount">0</span> NFTs</div>
              <p class="muted stat-caption">
                In a future phase, this will sync live with your IRAN NFT Solana collections using a real API.
              </p>
            </div>

            <div class="stat-card">
              <span class="stat-label">Active listings (local demo)</span>
              <div class="stat-value"><span id="statListingsCount">0</span> NFTs</div>
              <p class="muted stat-caption">
                Listings here are stored locally in your browser and meant as UI prototype for the real marketplace.
              </p>
            </div>

            <!-- Wallet balances -->
            <div class="stat-card">
              <span class="stat-label">Wallet balances</span>
              <div class="stat-value">
                <span id="statSolBalance">–</span> SOL
              </div>
              <p class="muted stat-caption">
                <span class="label-inline">i21 main token:</span>
                <strong><span id="statTokenBalanceI21">–</span></strong><br>
                <span class="label-inline">Market token (phase 2):</span>
                <strong><span id="statTokenBalanceMarket">coming soon</span></strong>
              </p>
            </div>

            <div class="stat-card">
              <span class="stat-label">Explore &amp; buy more</span>
              <div class="stat-value">IRAN NFT Market</div>
              <p class="muted stat-caption">
                Browse all drops and artworks in the main market page and complete trades on official platforms.
              </p>
              <button id="overviewGoExplore" class="btn btn-secondary">Go to Explore</button>
            </div>
          </div>

          <!-- Phase 2 – converter UI (only simulation for now) -->
          <!-- توضیحات این بخش را هر زمان خواستی می‌تونی مستقیم از همین HTML ویرایش کنی -->
          <div class="converter-card">
            <div class="converter-header">
              <h4>Phase 2 – i21 → Market token converter (UI only)</h4>
              <p class="muted">
                In the next phase, you will be able to convert your
                <strong>i21 main token</strong> into a dedicated
                <strong>Market token</strong> that is used only for buying IRAN NFT collections.
                A part of the converted i21 will be burned to support long-term scarcity.
              </p>
            </div>

            <div class="converter-grid">
              <div class="converter-field">
                <label for="convertInputI21">Amount of i21 to convert</label>
                <input
                  type="number"
                  id="convertInputI21"
                  min="0"
                  step="1"
                  placeholder="e.g. 1000"
                />
                <p class="muted small">
                  Current design:
                  <strong>100 i21 = 1 Market token</strong>.
                  This ratio can be updated later inside the on-chain contract if needed.
                </p>
                <p class="muted small">
                  Planned total supply for the Market token:
                  <strong>200,000,000</strong> units (hard cap).
                </p>
              </div>

              <div class="converter-result">
                <div class="stat-card converter-stat">
                  <span class="stat-label">Preview (no real transaction yet)</span>
                  <div class="stat-value">
                    <span id="convertOutputMarket">0</span> Market tokens
                  </div>
                  <p class="muted stat-caption">
                    Estimated burned i21 (planned):
                    <strong><span id="convertOutputBurn">0</span></strong>
                    from your input.
                  </p>
                  <button
                    class="btn btn-secondary"
                    disabled
                    title="Smart contract is not deployed yet – UI only"
                  >
                    Convert – Coming Soon
                  </button>
                </div>
              </div>
            </div>

            <div class="project-notes">
              <h4>How this system will work (concept)</h4>
              <ul>
                <li>
                  You send i21 to the converter contract. For each
                  <strong>100 i21</strong> you receive <strong>1 Market token</strong>.
                </li>
                <li>
                  A configurable percentage of the incoming i21 (for example
                  <strong>50%</strong>) is burned to reduce circulating supply.
                </li>
                <li>
                  The Market token can only be used for buying NFTs inside the IRAN NFT ecosystem.
                </li>
                <li>
                  In the final contract, a price oracle can be added so the rate can auto-adjust
                  based on i21 price, without changing this UI.
                </li>
                <li>
                  All numbers here are transparent and can be updated on-chain via governance or
                  a controlled admin, depending on how we design it later.
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- COLLECTION TAB -->
        <div id="panelCollection" class="panel-tab">
          <h4>My Collection (demo)</h4>
          <p class="muted">
            This section shows NFTs that are marked as owned by your wallet in the current demo dataset.
            Later, this will be replaced with a live Solana / OpenSea integration.
          </p>

          <div id="myCollectionGrid" class="nft-grid panel-grid-tight">
            <!-- Owned cards injected by JS -->
          </div>

          <div id="emptyMyCollection" class="empty-state hidden">
            <h3>No NFTs detected in demo</h3>
            <p>
              Once the real API is wired, your actual IRAN NFT holdings on Solana will appear here.
            </p>
          </div>
        </div>

        <!-- LISTINGS TAB -->
        <div id="panelListings" class="panel-tab">
          <h4>My Listings (local demo)</h4>
          <p class="muted">
            Here you can mark NFTs from your collection as “listed for sale”.
            This simulates a marketplace UI and persists per-wallet in your browser using <code>localStorage</code>.
          </p>

          <div id="myListingsGrid" class="nft-grid panel-grid-tight">
            <!-- Listing cards injected by JS -->
          </div>

          <div id="emptyMyListings" class="empty-state hidden">
            <h3>No active listings</h3>
            <p>
              Go to <strong>My Collection</strong>, choose an NFT and click <em>List for sale</em> to add it here.
            </p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- NFT MODAL -->
  <div id="nftModal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-dialog">
      <button id="modalCloseBtn" class="modal-close">&times;</button>
      <div class="modal-body">
        <div class="modal-image-wrapper">
          <img id="modalImage" src="" alt="">
        </div>
        <div class="modal-content">
          <h3 id="modalTitle"></h3>
          <p id="modalCollection" class="muted"></p>

          <div class="modal-tags">
            <span id="modalCategory" class="badge"></span>
            <span id="modalNetwork" class="badge badge-sol">Solana</span>
          </div>

          <p id="modalDescription" class="modal-description"></p>

          <div class="modal-meta">
            <div>
              <span class="label">Price</span>
              <div class="price-line">
                <span id="modalPrice"></span>
                <span class="currency-tag">SOL</span>
              </div>
            </div>
            <div>
              <span class="label">Creator</span>
              <p id="modalCreator" class="muted"></p>
            </div>
          </div>

          <div class="modal-actions">
            <a
              id="modalOpenSeaBtn"
              href="#"
              target="_blank"
              rel="noopener"
              class="btn btn-primary"
            >
              View / Trade on OpenSea
            </a>
            <button id="modalCloseBtn2" class="btn btn-ghost">Close</button>
          </div>

          <p class="modal-note">
            Note: Transactions are executed on Solana via the official marketplace.
            This interface only sends you to the live listing.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/@solana/web3.js@1.95.2/lib/index.iife.js"></script>
  <script src="../assets/js/market.js"></script>
</body>
</html>
